var synthetics = require('Synthetics');
const log = require('SyntheticsLogger');

const { SecretsManagerClient, GetSecretValueCommand } = require('@aws-sdk/client-secrets-manager');

const secretsClient = new SecretsManagerClient({ region: process.env.REGION });

const getSecret = async (secretId) => {
  try {
      const result = await secretsClient.send(new GetSecretValueCommand({ SecretId: secretId }));
      return JSON.parse(result.SecretString);
  } catch (err) {
      console.error(`Failed to fetch the secret from Secret Manager for SecretId: ${secretId}`, err);
      throw err;
  }
};

const recordedScript = async function () {
  let page = await synthetics.getPage();

  const secretId = process.env.SECRET_NAME;
  const { email, password } = await getSecret(secretId);
  
  await synthetics.executeStep('Goto_0', async function() {
    await page.goto("https://odira.live/", {waitUntil: 'domcontentloaded', timeout: 60000})
  })
  
  await page.setViewport({ width: 1512, height: 768 })
  
  await synthetics.executeStep('Click_1', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(1) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(1) > .nav-link > span')
  })
  
  await synthetics.executeStep('Click_2', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(2) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(2) > .nav-link > span')
  })
  
  await synthetics.executeStep('Click_3', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(3) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(3) > .nav-link > span')
  })
  
  await synthetics.executeStep('Click_4', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(4) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(4) > .nav-link > span')
  })
  
  await synthetics.executeStep('Click_5', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(5) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(5) > .nav-link > span')
  })
  
  await synthetics.executeStep('Click_6', async function() {
    await page.waitForSelector('#navbar > ul > li:nth-child(6) > .nav-link > span')
    await page.click('#navbar > ul > li:nth-child(6) > .nav-link > span')
  })
  
};
exports.handler = async () => {
    return await recordedScript();
};